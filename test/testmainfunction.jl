using DelimitedFiles
@testset "Testing main functions" begin

options = ConformationSetup(0.00001,classicalBP,false)
data = nmr("ins_15v2.pdb")

sol = conformation(data,options)

@test sol.number == 4

mol1 = MoleculeType([AtomType(0.0, 0.0, 0.0), 
		     AtomType(-1.526, 0.0, 0.0), 
		     AtomType(-2.034999999999995,1.4379999999999997,0.0), 
		     AtomType(-1.6749999999999972,2.1060000000000003,-1.3239999999999965), 
		     AtomType(-2.4299999999999944,3.4260000000000015,-1.4499999999999982),
		     AtomType(-1.9960000000000164,4.140999999999982,-2.726000000000016), 
		     AtomType(-0.47700000000001186,4.283999999999978,-2.7380000000000426), 
		     AtomType(-0.05900000000000982,5.365999999999996,-1.746000000000059), 
		     AtomType(-0.6160000000000029,6.71299999999999,-2.198000000000081), 
		     AtomType(-2.138000000000004,6.632999999999996,-2.283000000000105), 
		     AtomType(-2.7060000000000017,6.282000000000035,-0.9110000000000911),
		     AtomType(-4.211000000000007,6.055000000000045,-1.0260000000000806),
		     AtomType(-4.863999999999999,7.281000000000017,-1.6600000000001363),
		     AtomType(-5.922122878027752,7.841170383964165,-0.7130897001703507),
		     AtomType(-6.0663693289671485,9.342642843087825,-0.9430775604685648)], 7.862256122994717e-28 )


@test sol.molecules[1]≈mol1

mol2 =  MoleculeType([AtomType( 0.0 , 0.0 ,  0.0 ), 
		      AtomType( -1.526 , 0.0 ,  0.0 ), 
		      AtomType( -2.034999999999995 , 1.4379999999999997 ,  0.0 ), 
		      AtomType( -1.6749999999999972 , 2.1060000000000003 ,  -1.3239999999999965 ) , 
		      AtomType( -2.4299999999999944 , 3.4260000000000015 ,  -1.4499999999999982 ) ,
		      AtomType( -1.9960000000000164 , 4.140999999999982 ,  -2.726000000000016 ) ,   
		      AtomType( -0.47700000000001186 , 4.283999999999978 ,  -2.7380000000000426 ), 
		      AtomType( -0.05900000000000982 , 5.365999999999996 ,  -1.746000000000059 ) , 
		      AtomType( -0.6160000000000029 , 6.71299999999999 ,  -2.198000000000081 ) , 
		      AtomType( -2.138000000000004 , 6.632999999999996 ,  -2.283000000000105 ) , 
		      AtomType( -2.7060000000000017 , 6.282000000000035 ,  -0.9110000000000911 ), 
		      AtomType( -4.211000000000007 , 6.055000000000045 ,  -1.0260000000000806 ) , 
		      AtomType( -4.863999999999999 , 7.281000000000017 ,  -1.6600000000001363 ) , 
		      AtomType( -6.302 , 6.948000000000005 ,  -2.0490000000001407 ) , 
		      AtomType( -7.122000000000005 , 6.687000000000051 ,  -0.7890000000001312 )],7.853878489881605e-28)

@test sol.molecules[2]≈mol2

mol3 = MoleculeType([AtomType( 0.0 , 0.0 ,  0.0 ) ,
		     AtomType( -1.526 , 0.0 ,  0.0 ) ,
		     AtomType( -2.034999999999995 , 1.4379999999999997 ,  0.0 ) ,
		     AtomType( -1.6749999999999972 , 2.1060000000000003 ,  1.3239999999999965 ) ,
		     AtomType( -2.4299999999999944 , 3.4260000000000015 ,  1.4499999999999982 ) ,
		     AtomType( -1.9960000000000164 , 4.140999999999982 ,  2.726000000000016 ) ,
		     AtomType( -0.47700000000001186 , 4.283999999999978 ,  2.7380000000000426 ), 
		     AtomType( -0.05900000000000982 , 5.365999999999996 ,  1.746000000000059 ) ,
		     AtomType( -0.6160000000000029 , 6.71299999999999 ,  2.198000000000081 ) ,
		     AtomType( -2.138000000000004 , 6.632999999999996 ,  2.283000000000105 ) ,
		     AtomType( -2.7060000000000017 , 6.282000000000035 ,  0.9110000000000911 ), 
		     AtomType( -4.211000000000007 , 6.055000000000045 ,  1.0260000000000806 ) ,
		     AtomType( -4.863999999999999 , 7.281000000000017 ,  1.6600000000001363 ) ,
		     AtomType( -6.302 , 6.948000000000005 ,  2.0490000000001407 ) ],7.852246476949892e-28)

@test sol.molecules[3]≈mol3

mol4 = MoleculeType([AtomType( 0.0 , 0.0 ,  0.0 ),
		     AtomType( -1.526 , 0.0 ,  0.0 ),
		     AtomType( -2.034999999999995 , 1.4379999999999997 ,  0.0 ),
		     AtomType( -1.6749999999999972 , 2.1060000000000003 ,  1.3239999999999965 ),
		     AtomType( -2.4299999999999944 , 3.4260000000000015 ,  1.4499999999999982 ),
		     AtomType( -1.9960000000000164 , 4.140999999999982 ,  2.726000000000016 ),
		     AtomType( -0.47700000000001186 , 4.283999999999978 ,  2.7380000000000426 ), 
		     AtomType( -0.05900000000000982 , 5.365999999999996 ,  1.746000000000059 ),
		     AtomType( -0.6160000000000029 , 6.71299999999999 ,  2.198000000000081 ),
		     AtomType( -2.138000000000004 , 6.632999999999996 ,  2.283000000000105 ),
		     AtomType( -2.7060000000000017 , 6.282000000000035 ,  0.9110000000000911 ), 
		     AtomType( -4.211000000000007 , 6.055000000000045 ,  1.0260000000000806 ),
		     AtomType( -4.863999999999999 , 7.281000000000017 ,  1.6600000000001363 ),
		     AtomType( -5.922122878027752 , 7.841170383964165 ,  0.7130897001703507 ),
		     AtomType( -7.059383306135178 , 6.834224913707539 ,  0.5687964619691643 )],7.863165562712991e-28)

@test sol.molecules[4]≈mol4

end
